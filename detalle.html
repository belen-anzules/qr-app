<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Detalle del Plato - Macro Fit</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="header-clean">
    <a href="javascript:history.back()" class="back" style="text-decoration:none; font-size:24px;">â€¹</a>
    <h2 id="plato-nombre">Cargando...</h2>
    <div class="cart-icon" onclick="window.location.href='pedido.html'" style="font-size:22px;">ðŸ§¾</div>
</header>

<main class="detail-container">
    <div class="detail-img-header">
        <img id="plato-img" src="" alt="Plato">
    </div>

    <section class="detail-content" style="padding: 20px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 id="plato-titulo-sec" style="font-size:1.4rem; color:#2D3436;">Personaliza tu plato</h3>
            <span class="price-tag" style="font-size:1.1rem; color:#2E7D32; font-weight:bold;">$<span id="base-price-display">0.00</span></span>
        </div>

        <p id="plato-descripcion" style="color:#666; font-size:0.95rem; margin-bottom:20px; line-height:1.4;"></p>

        <h4 style="margin-bottom:15px; color:#333;">Extras Sugeridos:</h4>

        <div class="ingredient-item" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:10px;">
            <div class="ing-info">
                <span class="ing-name" style="font-weight:600;">Aguacate Extra</span>
                <span class="ing-price" style="display:block; font-size:0.8rem; color:#888;">+$1.00</span>
            </div>
            <div class="controls">
                <button class="btn-qty" onclick="changeQty('aguacate', -1)">âˆ’</button>
                <span id="aguacate-qty" style="margin:0 10px;">0</span>
                <button class="btn-qty" onclick="changeQty('aguacate', 1)">+</button>
            </div>
        </div>

        <div class="ingredient-item" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:10px;">
            <div class="ing-info">
                <span class="ing-name" style="font-weight:600;">ProteÃ­na Extra</span>
                <span class="ing-price" style="display:block; font-size:0.8rem; color:#888;">+$2.00</span>
            </div>
            <div class="controls">
                <button class="btn-qty" onclick="changeQty('proteina', -1)">âˆ’</button>
                <span id="proteina-qty" style="margin:0 10px;">0</span>
                <button class="btn-qty" onclick="changeQty('proteina', 1)">+</button>
            </div>
        </div>

        <div style="height: 120px;"></div>
    </section>
</main>

<div class="cart-footer" style="position:fixed; bottom:0; width:100%; background:white; padding:20px; box-shadow:0 -5px 15px rgba(0,0,0,0.05);">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; font-size:1.1rem;">
        <span>Total:</span>
        <span style="color:#2E7D32;">$<span id="total-price">0.00</span></span>
    </div>
    <button class="btn btn-primary" onclick="confirmarPedido()" style="width:100%; padding:15px; background:#2E7D32; color:white; border:none; border-radius:12px; font-weight:bold; font-size:1rem;">AÃ±adir al Carrito âœ…</button>
</div>

<script>
    let currentBasePrice = 0;
    let extras = { aguacate: 0, proteina: 0 };
    const extraPrices = { aguacate: 1.00, proteina: 2.00 };

    window.onload = () => {
        const params = new URLSearchParams(window.location.search);
        
        // Cargar datos de la URL
        const nombre = params.get('p_nombre') || "Plato Saludable";
        currentBasePrice = parseFloat(params.get('p_precio')) || 0.00;
        const imagen = params.get('p_img') || "";
        const descripcion = params.get('p_desc') || "Deliciosa opciÃ³n saludable preparada con ingredientes frescos.";

        // Inyectar en el HTML
        document.getElementById('plato-nombre').innerText = nombre;
        document.getElementById('plato-titulo-sec').innerText = nombre;
        document.getElementById('plato-img').src = imagen;
        document.getElementById('plato-descripcion').innerText = descripcion;
        document.getElementById('base-price-display').innerText = currentBasePrice.toFixed(2);
        
        updateTotal();
    };

    function changeQty(ing, val) {
        if (extras[ing] + val >= 0) {
            extras[ing] += val;
            document.getElementById(`${ing}-qty`).innerText = extras[ing];
            updateTotal();
        }
    }

    function updateTotal() {
        let total = currentBasePrice;
        for (let key in extras) {
            total += extras[key] * extraPrices[key];
        }
        document.getElementById('total-price').innerText = total.toFixed(2);
    }

    function confirmarPedido() {
        const item = {
            nombre: document.getElementById('plato-nombre').innerText,
            total: document.getElementById('total-price').innerText,
            img: document.getElementById('plato-img').src,
            detalles: `Aguacate: ${extras.aguacate}, ProteÃ­na: ${extras.proteina}`
        };
        
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.push(item);
        localStorage.setItem('cart', JSON.stringify(cart));
        
        alert("Â¡AÃ±adido al carrito!");
        window.location.href = 'pedido.html';
    }
</script>
</body>
</html>