<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmar Pedido</title>

<style>
:root { --primary:#4CAF50; --bg:#f8f9fa; --dark:#1a1a1a; }
body { font-family:Segoe UI,Roboto,sans-serif; background:var(--bg); margin:0; padding-bottom:140px; }
header { background:#fff; padding:20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,.05); }
.back-btn { border:none; width:45px; height:45px; border-radius:15px; font-size:1.2rem; }
.cart-card { background:#fff; padding:18px; border-radius:25px; margin:15px; box-shadow:0 10px 20px rgba(0,0,0,.03); }
.footer-total { position:fixed; bottom:0; width:100%; background:#fff; padding:25px; border-radius:30px 30px 0 0; box-shadow:0 -15px 30px rgba(0,0,0,.08); }
.btn-confirm { width:100%; padding:20px; border:none; border-radius:20px; background:var(--primary); color:#fff; font-weight:800; }
.modal { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; justify-content:center; align-items:center; }
.modal-content { background:#fff; padding:30px; border-radius:30px; width:90%; max-width:420px; }
input { width:100%; padding:15px; margin-top:6px; border-radius:15px; border:2px solid #eee; }
</style>
</head>

<body>

<header>
<button class="back-btn" onclick="history.back()">‚¨ÖÔ∏è</button>
<h3>Confirmar Pedido</h3>
<div style="width:45px"></div>
</header>

<div id="pedido-lista"></div>

<div class="footer-total">
<div style="display:flex; justify-content:space-between; margin-bottom:15px;">
<span>Total</span>
<strong>$<span id="total-global">0.00</span></strong>
</div>
<button class="btn-confirm" onclick="abrirRegistro()">FINALIZAR COMPRA üöÄ</button>
</div>

<div id="modal" class="modal">
<div class="modal-content">
<h2>Tus Datos</h2>

<input id="nom" placeholder="Nombre completo">
<input id="ced" placeholder="C√©dula">
<input id="tel" placeholder="Tel√©fono">
<input id="dir" placeholder="Direcci√≥n">

<button class="btn-confirm" onclick="generarTicket()">GENERAR TICKET</button>
<button style="margin-top:15px" onclick="cerrar()">Cancelar</button>
</div>
</div>

<script>
function getCart() {
    const p = new URLSearchParams(location.search);
    try {
        return JSON.parse(decodeURIComponent(p.get("cart"))) || [];
    } catch {
        return [];
    }
}

function render() {
    const cart = getCart();
    let total = 0;
    const lista = document.getElementById("pedido-lista");

    if (!cart.length) {
        lista.innerHTML = "<p style='text-align:center'>Carrito vac√≠o</p>";
        return;
    }

    cart.forEach(p => {
        total += parseFloat(p.total);
        lista.innerHTML += `
            <div class="cart-card">
                <strong>${p.nombre}</strong><br>
                <small>${p.extras || ''}</small><br>
                <strong>$${p.total}</strong>
            </div>
        `;
    });

    document.getElementById("total-global").innerText = total.toFixed(2);
}

function abrirRegistro() {
    document.getElementById("modal").style.display = "flex";
}
function cerrar() {
    document.getElementById("modal").style.display = "none";
}

function generarTicket() {
    const nom = nomInput.value.trim();
    const ced = cedInput.value.trim();
    const tel = telInput.value.trim();
    const dir = dirInput.value.trim();

    if (!nom || !ced || !tel || !dir) {
        alert("Completa todos los campos");
        return;
    }

    const ticket = {
        cod: "MF-" + Math.floor(100000 + Math.random() * 900000),
        nom, ci: ced, tel, dir,
        fec: new Date().toLocaleDateString(),
        hor: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
    };

    const url = "ver-ticket.html?" +
        `cod=${ticket.cod}&nom=${encodeURIComponent(ticket.nom)}` +
        `&ci=${ticket.ci}&tel=${ticket.tel}` +
        `&dir=${encodeURIComponent(ticket.dir)}` +
        `&fec=${ticket.fec}&hor=${ticket.hor}`;

    location.href = url;
}

const nomInput = document.getElementById("nom");
const cedInput = document.getElementById("ced");
const telInput = document.getElementById("tel");
const dirInput = document.getElementById("dir");

window.onload = render;
</script>

</body>
</html>
