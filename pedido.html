<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmar Pedido - Macro Fit</title>

<style>
:root { --primary:#4CAF50; --bg:#f8f9fa; --dark:#1a1a1a; --error:#ff4d4d; }

body {
    font-family:Segoe UI, Roboto, sans-serif;
    background:var(--bg);
    margin:0;
    padding-bottom:140px;
    color:var(--dark);
}

/* HEADER */
header {
    background:#fff;
    padding:20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    position:sticky;
    top:0;
    z-index:100;
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
}

.back-btn {
    background:#eee;
    border:none;
    width:45px;
    height:45px;
    border-radius:15px;
    font-size:1.2rem;
    cursor:pointer;
}

/* LISTA */
#pedido-lista { padding:15px; }

.cart-card {
    background:#fff;
    padding:18px;
    border-radius:25px;
    margin-bottom:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 10px 20px rgba(0,0,0,0.03);
}

.cart-details strong { font-size:1.1rem; display:block; }
.cart-details p { font-size:0.85rem; color:#888; margin:4px 0; }

.price-tag {
    color:var(--primary);
    font-weight:800;
}

/* BOTONES */
.cart-actions { display:flex; gap:10px; }

.btn-action {
    border:none;
    padding:12px;
    border-radius:15px;
    font-size:1.1rem;
    cursor:pointer;
}

.btn-edit { background:#e8f5e9; color:var(--primary); }
.btn-del { background:#fff1f1; color:var(--error); }

/* FOOTER */
.footer-total {
    position:fixed;
    bottom:0;
    width:100%;
    background:#fff;
    padding:25px;
    border-radius:30px 30px 0 0;
    box-shadow:0 -15px 30px rgba(0,0,0,0.08);
}

.total-row {
    display:flex;
    justify-content:space-between;
    margin-bottom:20px;
}

.btn-confirm {
    background:var(--primary);
    color:white;
    border:none;
    width:100%;
    padding:20px;
    border-radius:20px;
    font-weight:800;
    cursor:pointer;
}

/* MODAL */
.modal {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    display:none;
    justify-content:center;
    align-items:center;
}

.modal-content {
    background:white;
    padding:35px;
    border-radius:35px;
    width:88%;
    max-width:420px;
    text-align:center;
}

.input-group { text-align:left; margin-bottom:15px; }

.input-group label {
    font-size:0.7rem;
    font-weight:800;
    color:#aaa;
    text-transform:uppercase;
}

.modal-content input {
    width:100%;
    padding:16px;
    margin-top:6px;
    border:2px solid #f0f0f0;
    border-radius:18px;
}

.modal-content input.error {
    border-color:var(--error);
}

.modal-content input.success {
    border-color:var(--primary);
}
</style>
</head>

<body onload="render()">

<header>
    <button class="back-btn" onclick="irAMenu()">‚¨ÖÔ∏è</button>
    <h3 style="margin:0;font-weight:800;">Confirmar Pedido</h3>
    <div style="width:45px"></div>
</header>

<div id="pedido-lista"></div>

<div class="footer-total">
    <div class="total-row">
        <span>Total</span>
        <strong>$<span id="total-global">0.00</span></strong>
    </div>
    <button class="btn-confirm" id="btn-main" onclick="abrirRegistro()">FINALIZAR COMPRA üöÄ</button>
</div>

<!-- MODAL -->
<div id="modal-reg" class="modal">
<div class="modal-content">
    <h2>Tus Datos</h2>

    <div class="input-group">
        <label>Nombre</label>
        <input id="nom">
    </div>

    <div class="input-group">
        <label>C√©dula</label>
        <input id="ced">
    </div>

    <div class="input-group">
        <label>WhatsApp</label>
        <input id="tel">
    </div>

    <div class="input-group">
        <label>Direcci√≥n</label>
        <input id="dir">
    </div>

    <button class="btn-confirm" onclick="generarTicket()">GENERAR MI TICKET ‚ú®</button>
    <button onclick="cerrarModal()" style="background:none;border:none;color:#aaa;margin-top:15px;">Cancelar</button>
</div>
</div>

<script>
function getCart(){
    const p = new URLSearchParams(location.search);
    try {
        return p.get("cart") ? JSON.parse(decodeURIComponent(p.get("cart"))) : [];
    } catch {
        return [];
    }
}

function render(){
    const cart = getCart();
    const lista = document.getElementById("pedido-lista");
    const totalSpan = document.getElementById("total-global");
    const btn = document.getElementById("btn-main");
    let total = 0;

    if(!cart.length){
        lista.innerHTML = "<p style='text-align:center'>üõí Carrito vac√≠o</p>";
        btn.disabled = true;
        btn.style.opacity = .4;
        return;
    }

    lista.innerHTML = "";
    cart.forEach((item,i)=>{
        total += parseFloat(item.total);
        const cartStr = encodeURIComponent(JSON.stringify(cart));

        lista.innerHTML += `
        <div class="cart-card">
            <div class="cart-details">
                <strong>${item.nombre}</strong>
                <p>${item.extras || ''}</p>
                <span class="price-tag">$${parseFloat(item.total).toFixed(2)}</span>
            </div>
            <div class="cart-actions">
                <button class="btn-action btn-edit"
                    onclick="location.href='${item.page}?cart=${cartStr}&editIndex=${i}'">‚úèÔ∏è</button>
                <button class="btn-action btn-del"
                    onclick="eliminar(${i})">üóëÔ∏è</button>
            </div>
        </div>`;
    });

    totalSpan.innerText = total.toFixed(2);
}

function eliminar(i){
    const cart = getCart();
    cart.splice(i,1);
    location.href = "pedido.html?cart=" + encodeURIComponent(JSON.stringify(cart));
}

function irAMenu(){
    location.href = "menu.html?cart=" + encodeURIComponent(JSON.stringify(getCart()));
}

function abrirRegistro(){ document.getElementById("modal-reg").style.display="flex"; }
function cerrarModal(){ document.getElementById("modal-reg").style.display="none"; }

function generarTicket(){
    const campos = [nom,ced,tel,dir];
    let ok = true;

    campos.forEach(c=>{
        c.classList.remove("error","success");
        if(!c.value.trim()){ c.classList.add("error"); ok=false; }
        else c.classList.add("success");
    });

    if(!ok) return;

    const ticket = {
        id: "MF-" + Math.floor(100000 + Math.random()*900000),
        cliente: nom.value,
        total: document.getElementById("total-global").innerText,
        fecha: new Date().toLocaleDateString(),
        hora: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
    };

    localStorage.setItem("ticketActual", JSON.stringify(ticket));
    location.href = "ver-ticket.html";
}
</script>

</body>
</html>
