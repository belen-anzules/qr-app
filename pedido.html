<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmar Pedido - Macro Fit</title>

<style>
:root{
    --primary:#4CAF50;
    --bg:#f8f9fa;
    --dark:#1a1a1a;
    --soft:#ececec;
    --error:#ff4d4d;
}

*{box-sizing:border-box}

body{
    margin:0;
    font-family:Segoe UI, Roboto, sans-serif;
    background:var(--bg);
    color:var(--dark);
    padding-bottom:190px;
}

/* ===== HEADER ===== */
header{
    background:#fff;
    padding:18px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    position:sticky;
    top:0;
    z-index:10;
    box-shadow:0 2px 12px rgba(0,0,0,.06);
}

.back-btn{
    width:44px;height:44px;
    border-radius:14px;
    border:none;
    background:#eee;
    font-size:1.2rem;
    cursor:pointer;
}

/* ===== LISTA PEDIDO ===== */
#pedido-lista{ padding:18px; }

.cart-card{
    background:#fff;
    padding:18px;
    border-radius:26px;
    margin-bottom:15px;
    display:flex;
    justify-content:space-between;
    gap:15px;
    box-shadow:0 12px 25px rgba(0,0,0,.05);
}

.cart-details strong{
    font-size:1.05rem;
    display:block;
}

.cart-details p{
    font-size:.8rem;
    color:#888;
    margin:4px 0;
}

.price{
    font-weight:900;
    color:var(--primary);
    font-size:1.05rem;
}

.cart-actions{
    display:flex;
    flex-direction:column;
    gap:10px;
}

.btn-icon{
    border:none;
    width:42px;
    height:42px;
    border-radius:14px;
    font-size:1.1rem;
    cursor:pointer;
}

.btn-edit{background:#e8f5e9;color:var(--primary);}
.btn-del{background:#fff1f1;color:var(--error);}

/* ===== FOOTER TOTAL ===== */
.footer-total{
    position:fixed;
    bottom:0;
    width:100%;
    background:#fff;
    padding:20px;
    padding-bottom:calc(20px + env(safe-area-inset-bottom));
    border-radius:30px 30px 0 0;
    box-shadow:0 -15px 35px rgba(0,0,0,.12);
}

.total-box{
    background:#f1fdf4;
    padding:16px;
    border-radius:20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}

.total-box span{ font-size:.85rem; color:#555; }
.total-box strong{ font-size:1.4rem; color:var(--primary); }

.btn-confirm{
    width:100%;
    padding:20px;
    border:none;
    border-radius:22px;
    background:var(--primary);
    color:white;
    font-weight:900;
    font-size:1rem;
    cursor:pointer;
}

/* ===== CARRITO VAC√çO ===== */
.empty-cart{
    text-align:center;
    padding:60px 20px;
}
.empty-cart h2{font-size:3rem;margin:0;}
.empty-cart p{color:#777;}

/* ===== MODAL DATOS ===== */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.55);
    display:none;
    justify-content:center;
    align-items:flex-end;
    z-index:1000;
}

.modal-content{
    background:#fff;
    width:100%;
    max-width:480px;
    padding:30px 22px 40px;
    border-radius:30px 30px 0 0;
    animation:up .3s ease;
}

@keyframes up{
    from{transform:translateY(100%);}
    to{transform:translateY(0);}
}

.modal-content h2{
    text-align:center;
    margin:0 0 20px;
}

/* ===== INPUTS ===== */
.input-group{
    margin-bottom:15px;
}

.input-group label{
    font-size:.7rem;
    font-weight:800;
    color:#999;
    text-transform:uppercase;
}

.input-group input{
    width:100%;
    padding:18px;
    border-radius:18px;
    border:2px solid #eee;
    font-size:.95rem;
}

.input-group input:focus{
    outline:none;
    border-color:var(--primary);
}

input.error{border-color:var(--error);}
input.success{border-color:var(--primary);}

.modal-actions{
    margin-top:20px;
}

.modal-actions button{
    width:100%;
    padding:18px;
    border-radius:22px;
    border:none;
    font-weight:900;
}

.btn-gen{background:var(--primary);color:white;}
.btn-cancel{
    margin-top:10px;
    background:none;
    color:#888;
}
</style>
</head>

<body onload="render()">

<header>
<button class="back-btn" onclick="irAMenu()">‚¨ÖÔ∏è</button>
<h3 style="margin:0;font-weight:900;">Confirmar Pedido</h3>
<div style="width:44px"></div>
</header>

<div id="pedido-lista"></div>

<div class="footer-total">
<div class="total-box">
<span>Total a pagar</span>
<strong>$<span id="total-global">0.00</span></strong>
</div>
<button class="btn-confirm" id="btn-main" onclick="abrirRegistro()">FINALIZAR COMPRA üöÄ</button>
</div>

<!-- MODAL -->
<div class="modal" id="modal-reg">
<div class="modal-content">
<h2>üßæ Tus datos</h2>

<div class="input-group">
<label>Nombre</label>
<input id="nom">
</div>

<div class="input-group">
<label>C√©dula</label>
<input id="ced">
</div>

<div class="input-group">
<label>WhatsApp</label>
<input id="tel">
</div>

<div class="input-group">
<label>Direcci√≥n</label>
<input id="dir">
</div>

<div class="modal-actions">
<button class="btn-gen" onclick="generarTicket()">GENERAR TICKET ‚ú®</button>
<button class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
</div>
</div>
</div>

<script>
function getCart(){
    const p=new URLSearchParams(location.search);
    return p.get("cart")?JSON.parse(decodeURIComponent(p.get("cart"))):[];
}

function render(){
    const cart=getCart();
    const lista=document.getElementById("pedido-lista");
    const totalSpan=document.getElementById("total-global");
    const btn=document.getElementById("btn-main");
    let total=0;

    if(!cart.length){
        lista.innerHTML=`
        <div class="empty-cart">
            <h2>üõí</h2>
            <p>Tu carrito est√° vac√≠o</p>
        </div>`;
        btn.disabled=true;
        btn.style.opacity=.4;
        return;
    }

    lista.innerHTML="";
    cart.forEach((i,idx)=>{
        total+=parseFloat(i.total);
        const cartStr=encodeURIComponent(JSON.stringify(cart));

        lista.innerHTML+=`
        <div class="cart-card">
            <div class="cart-details">
                <strong>${i.nombre}</strong>
                <p>${i.extras||""}</p>
                <div class="price">$${parseFloat(i.total).toFixed(2)}</div>
            </div>

            <div class="cart-actions">
                <button class="btn-icon btn-edit"
                    onclick="location.href='${i.page}?cart=${cartStr}&editIndex=${idx}'">‚úèÔ∏è</button>
                <button class="btn-icon btn-del"
                    onclick="eliminar(${idx})">üóëÔ∏è</button>
            </div>
        </div>`;
    });

    totalSpan.innerText=total.toFixed(2);
}

function eliminar(i){
    const cart=getCart();
    cart.splice(i,1);
    location.href="pedido.html?cart="+encodeURIComponent(JSON.stringify(cart));
}

function abrirRegistro(){document.getElementById("modal-reg").style.display="flex";}
function cerrarModal(){document.getElementById("modal-reg").style.display="none";}
function irAMenu(){
    location.href="menu.html?cart="+encodeURIComponent(JSON.stringify(getCart()));
}

function generarTicket(){
    const campos=[nom,ced,tel,dir];
    let ok=true;

    campos.forEach(c=>{
        c.classList.remove("error","success");
        if(!c.value.trim()){c.classList.add("error");ok=false;}
        else c.classList.add("success");
    });

    if(!ok) return;

    const ticket={
        id:"MF-"+Math.floor(100000+Math.random()*900000),
        cliente:nom.value,
        direccion:dir.value,
        total:document.getElementById("total-global").innerText,
        fecha:new Date().toLocaleDateString(),
        hora:new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})
    };

    localStorage.setItem("ticketActual",JSON.stringify(ticket));
    location.href="ver-ticket.html";
}
</script>

</body>
</html>
